<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockFlow - Material Management</title>
    <meta name="theme-color" content="#6366f1">
    <link rel="manifest" href="manifest.json">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Modern Background -->
    <div class="app-background"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-boxes"></i>
            <span data-i18n="app.name">StockFlow</span>
        </div>
        <div class="nav-actions">
            <button class="lang-switcher" onclick="toggleLanguage()">
                <span id="langCode">EN</span>
                <i class="fas fa-globe"></i>
            </button>
            <div class="nav-user">
                <span>Nexa</span>
                <div class="user-avatar">N</div>
            </div>
        </div>
    </nav>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Dashboard View -->
        <div id="dashboardView" class="view active">
            <div class="header">
                <h1 data-i18n="dashboard.title">Dashboard</h1>
                <span id="currentDate" class="date"></span>
            </div>

            <!-- Quick Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon total">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalMaterials">0</h3>
                        <p data-i18n="dashboard.totalMaterials">Total Materials</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon in-stock">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="inStock">0</h3>
                        <p data-i18n="dashboard.inStock">In Stock</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon low-stock">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="lowStock">0</h3>
                        <p data-i18n="dashboard.lowStock">Low Stock</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon out-of-stock">
                        <i class="fas fa-times"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="outOfStock">0</h3>
                        <p data-i18n="dashboard.outOfStock">Out of Stock</p>
                    </div>
                </div>
            </div>

            <!-- Critical Alerts -->
            <div class="section">
                <div class="section-header">
                    <h2><i class="fas fa-bell"></i> <span data-i18n="dashboard.criticalAlerts">Critical Alerts</span></h2>
                    <span class="badge" id="alertCount">0</span>
                </div>
                <div id="alertsContainer" class="alerts-container">
                    <div class="alert-item alert-info">
                        <div class="alert-message" data-i18n="dashboard.noAlerts">No active alerts</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section">
                <h2><i class="fas fa-bolt"></i> <span data-i18n="dashboard.quickActions">Quick Actions</span></h2>
                <div class="actions-grid">
                    <button class="action-btn" onclick="showView('scanView')">
                        <i class="fas fa-camera"></i>
                        <span data-i18n="actions.scanMaterial">Scan Material</span>
                    </button>
                    <button class="action-btn" onclick="showView('usageView')">
                        <i class="fas fa-clipboard-list"></i>
                        <span data-i18n="actions.recordUsage">Record Usage</span>
                    </button>
                    <button class="action-btn" onclick="showView('materialsView')">
                        <i class="fas fa-search"></i>
                        <span data-i18n="actions.checkStock">Check Stock</span>
                    </button>
                    <button class="action-btn" onclick="showView('addStockView')">
                        <i class="fas fa-plus"></i>
                        <span data-i18n="actions.addStock">Add Stock</span>
                    </button>
                    <button class="action-btn" onclick="showView('settingsView')">
                        <i class="fas fa-cog"></i>
                        <span data-i18n="actions.settings">Settings</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Scan Material View -->
        <div id="scanView" class="view">
            <div class="header">
                <button class="back-btn" onclick="showView('dashboardView')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 data-i18n="scan.title">Scan Material</h1>
            </div>

            <div class="scan-container">
                <div class="scanner-placeholder">
                    <i class="fas fa-camera"></i>
                    <p data-i18n="scan.barcodeScanner">Barcode Scanner</p>
                    <button class="btn btn-primary" onclick="simulateScan()">
                        <i class="fas fa-qrcode"></i>
                        <span data-i18n="scan.simulateScan">Simulate Scan</span>
                    </button>
                </div>
                
                <div id="scanResult" class="scan-result" style="display: none;">
                    <!-- Scan results will appear here -->
                </div>
            </div>
        </div>

        <!-- Record Usage View -->
        <div id="usageView" class="view">
            <div class="header">
                <button class="back-btn" onclick="showView('dashboardView')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 data-i18n="usage.title">Record Material Usage</h1>
            </div>

            <form id="usageForm" class="form">
                <div class="form-group">
                    <label for="department" data-i18n="usage.department">Department</label>
                    <select id="department" required>
                        <option value="" data-i18n="usage.selectDepartment">Select Department</option>
                        <option value="electrical" data-i18n="departments.electrical">Electrical</option>
                        <option value="production" data-i18n="departments.production">Production</option>
                        <option value="maintenance" data-i18n="departments.maintenance">Maintenance</option>
                        <option value="quality" data-i18n="departments.quality">Quality Control</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="project" data-i18n="usage.projectCode">Project Code</label>
                    <input type="text" id="project" placeholder="e.g., PROJ-ALPHA" data-i18n-placeholder="usage.projectPlaceholder">
                </div>

                <div class="form-group">
                    <label for="materialSelect" data-i18n="usage.material">Material</label>
                    <select id="materialSelect" required>
                        <option value="" data-i18n="usage.selectMaterial">Select Material</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="quantity" data-i18n="usage.quantity">Quantity Used</label>
                    <input type="number" id="quantity" step="0.01" min="0.01" required>
                </div>

                <div class="form-group">
                    <label for="notes" data-i18n="usage.notes">Notes</label>
                    <textarea id="notes" data-i18n-placeholder="usage.notesPlaceholder"></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-save"></i>
                    <span data-i18n="usage.recordUsage">Record Usage</span>
                </button>
            </form>
        </div>

        <!-- Add Stock View -->
        <div id="addStockView" class="view">
            <div class="header">
                <button class="back-btn" onclick="showView('dashboardView')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 data-i18n="addStock.title">Add New Stock</h1>
            </div>

            <form id="addStockForm" class="form">
                <div class="form-group">
                    <label for="newMaterialName" data-i18n="addStock.materialName">Material Name</label>
                    <input type="text" id="newMaterialName" required>
                </div>

                <div class="form-group">
                    <label for="materialCode" data-i18n="addStock.materialCode">Material Code</label>
                    <input type="text" id="materialCode" required>
                </div>

                <div class="form-group">
                    <label for="category" data-i18n="addStock.category">Category</label>
                    <select id="category">
                        <option value="raw" data-i18n="categories.raw">Raw Material</option>
                        <option value="electrical" data-i18n="categories.electrical">Electrical</option>
                        <option value="mechanical" data-i18n="categories.mechanical">Mechanical</option>
                        <option value="packaging" data-i18n="categories.packaging">Packaging</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="unit" data-i18n="addStock.unit">Unit of Measure</label>
                    <select id="unit" required>
                        <option value="units" data-i18n="units.units">Units</option>
                        <option value="kg" data-i18n="units.kg">Kilograms</option>
                        <option value="meters" data-i18n="units.meters">Meters</option>
                        <option value="liters" data-i18n="units.liters">Liters</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="initialQuantity" data-i18n="addStock.initialQuantity">Initial Quantity</label>
                    <input type="number" id="initialQuantity" step="0.01" min="0" required>
                </div>

                <div class="form-group">
                    <label for="minStock" data-i18n="addStock.minStock">Minimum Stock Level</label>
                    <input type="number" id="minStock" step="0.01" min="0" required>
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-plus"></i>
                    <span data-i18n="addStock.addMaterial">Add Material</span>
                </button>
            </form>
        </div>

        <!-- Materials List View -->
        <div id="materialsView" class="view">
            <div class="header">
                <button class="back-btn" onclick="showView('dashboardView')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 data-i18n="materials.title">All Materials</h1>
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="materialSearch" data-i18n-placeholder="materials.searchPlaceholder">
                </div>
            </div>

            <div id="materialsList" class="materials-list">
                <!-- Materials will be loaded here -->
            </div>
        </div>

        <!-- Settings View -->
        <div id="settingsView" class="view">
            <div class="header">
                <button class="back-btn" onclick="showView('dashboardView')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 data-i18n="settings.title">Settings</h1>
            </div>

            <div class="section">
                <h2><i class="fas fa-sliders-h"></i> <span data-i18n="settings.general">General Settings</span></h2>
                
                <div class="settings-grid">
                    <div class="setting-item">
                        <label data-i18n="settings.autoReorder">Auto Reorder</label>
                        <label class="switch">
                            <input type="checkbox" id="autoReorder" onchange="updateSetting('autoReorder', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label data-i18n="settings.enableCategories">Enable Categories</label>
                        <label class="switch">
                            <input type="checkbox" id="enableCategories" onchange="updateSetting('enableCategories', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label data-i18n="settings.enableSuppliers">Enable Suppliers</label>
                        <label class="switch">
                            <input type="checkbox" id="enableSuppliers" onchange="updateSetting('enableSuppliers', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2><i class="fas fa-database"></i> <span data-i18n="settings.dataManagement">Data Management</span></h2>
                
                <button class="btn btn-block" onclick="exportData()">
                    <i class="fas fa-download"></i>
                    <span data-i18n="settings.exportData">Export Data</span>
                </button>
                
                <button class="btn btn-block" onclick="resetData()" style="margin-top: 1rem; background: var(--danger);">
                    <i class="fas fa-trash"></i>
                    <span data-i18n="settings.resetData">Reset to Defaults</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-item active" onclick="showView('dashboardView')">
            <i class="fas fa-home"></i>
            <span data-i18n="navigation.dashboard">Dashboard</span>
        </button>
        <button class="nav-item" onclick="showView('scanView')">
            <i class="fas fa-camera"></i>
            <span data-i18n="navigation.scan">Scan</span>
        </button>
        <button class="nav-item" onclick="showView('usageView')">
            <i class="fas fa-clipboard-list"></i>
            <span data-i18n="navigation.usage">Usage</span>
        </button>
        <button class="nav-item" onclick="showView('materialsView')">
            <i class="fas fa-boxes"></i>
            <span data-i18n="navigation.stock">Stock</span>
        </button>
        <button class="nav-item" onclick="showView('settingsView')">
            <i class="fas fa-cog"></i>
            <span data-i18n="navigation.settings">Settings</span>
        </button>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast"></div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.2.1/dist/dexie.min.js"></script>
    
    <!-- App Scripts - IMPORTANT: Load in correct order -->
    <script src="js/database.js"></script>
    <script src="js/config.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/api.js"></script>
    <script src="js/scanner.js"></script>
    
    <!-- Main App MUST be last -->
    <script src="js/app.js"></script>
</body>
</html>